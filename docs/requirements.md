# 需求文档

结合您的需求和提供的 Electron 应用更新文档，一个轻量级的应用分发平台架构应包含以下核心模块和功能：

## 核心功能模块
该平台的核心在于高效管理全量包、增量包，并提供智能版本检查接口。

### 1. 应用与版本管理模块
- 应用定义：定义应用的基础信息，包括平台 (platform 如 win32 / darwin)、架构 (arch 如 x64 / arm64) 和唯一的应用标识符。
- 包管理：区分和存储两类包文件：
  - 全量包 (Installer)：完整的安装程序（如 .apk, .dmg, .exe）。
  - 增量包 (Patch/Zip)：仅包含前端渲染层静态资源的压缩包（如 dist.zip），适用于热更新场景。
- 版本记录：使用 versionCode/appVersion（安装包版本）和 rendererVersion（热更新版本）双版本号体系来精确追踪客户端状态。

### 2. 文件上传与处理模块
- 上传接口：提供安全的接口供上传安装包和增量包文件。
- 自动处理：上传后自动执行必要操作，例如：
  - 计算文件的 SHA256 校验值，用于客户端下载后验证文件完整性。
  - （可选）自动生成版本元数据文件（例如 latest-mac.yml），以兼容 electron-updater 等标准工具。

### 3. 版本检查接口 (API)
这是客户端与平台交互的核心，需遵循简洁的协议规范。
- 请求协议：客户端发起 GET 请求，携带当前版本信息作为 Query 参数。
  - URL: https://example.com/check (可配置)
  - Query: appVersion, rendererVersion, platform, arch
- 响应协议：服务端根据策略返回 JSON 格式的更新指令。
  - updateType: "none", "hot", "installer" – 指示无更新、热更新或强制安装包更新
  - version: "1.0.1" – 新版本号
  - url: "https://..." – 新包的下载地址（全量包或增量包地址）
  - sha256: "可选：zip文件哈希值" – 用于安全校验的可选字段

### 4. 存储与分发模块
- 云存储 (OSS/OBS)：利用对象存储服务托管大文件，利用预签名 URL 实现高速、安全的下载。
- CDN 加速：针对大规模用户提供内容分发网络加速，提升全球用户的下载体验。
- 客户端回滚：支持客户端侧删除本地更新目录，回退到安装包内置版本，提高系统的健壮性。